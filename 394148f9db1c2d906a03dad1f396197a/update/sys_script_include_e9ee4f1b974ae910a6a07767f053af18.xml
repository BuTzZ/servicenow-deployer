<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>public</access>
        <active>true</active>
        <api_name>x_snc_deployer.GetRepoDependencyList</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>GetRepoDependencyList</name>
        <script><![CDATA[function GetRepoDependencyList(strRepoUrl,strVersion)
{
	var GetArrayValue = x_snc_devtools.GetArrayValue;
	var Clone = x_snc_devtools.Clone;
	var GetValue = x_snc_devtools.GetValue;
	var GetMinimalCommonVersion = x_snc_devtools.GetMinimalCommonVersion;
	var IsVersionCompatible = x_snc_devtools.IsVersionCompatible;
	
	var dependencytree = GetRepoDependencyTree(strRepoUrl,strVersion);
	if (dependencytree == false)
	{
		return false;
	}

	var aPackages = [];
		
	function ResolveDependencyTree(currentpackage)
	{
		var currentpackage = Clone(currentpackage);
		
		var aDependencies = GetArrayValue(GetValue(currentpackage,'_dependencies'));
		for (var nDependency = 0; nDependency < aDependencies.length; nDependency++)
		{
			ResolveDependencyTree(aDependencies[nDependency]);
		}
		currentpackage['_dependencies'] = null;
		var bExists = false;
		for (var nPackage = 0; nPackage < aPackages.length; nPackage++)
		{
			if (aPackages[nPackage]['dependency_status'] != 'circular')
			{
				if (aPackages[nPackage]['sys_id'] == currentpackage['sys_id'])
				{
					bExists = true;
					
					var strMinimalCommonVersion = GetMinimalCommonVersion(
						aPackages[nPackage]['compatible_versions'],
						currentpackage['compatible_versions']);
					
					if (strMinimalCommonVersion == false)
					{
						aPackages[nPackage]['compatible_versions'] = '';
						aPackages[nPackage]['dependency_status'] = 'conflicting_versions';
					}
					else
					{
						aPackages[nPackage]['compatible_versions'] = strMinimalCommonVersion;
						if (IsVersionCompatible(currentpackage['version'],strMinimalCommonVersion) == false)
						{
							aPackages[nPackage]['dependency_status'] = 'incompatible_version';
						}
					}
					
				}
			}
		}
		if (bExists == false)
		{
			aPackages.push(currentpackage)
		}
	}
	
	ResolveDependencyTree(dependencytree);
	
	return aPackages;
}]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2023-04-12 15:35:39</sys_created_on>
        <sys_id>e9ee4f1b974ae910a6a07767f053af18</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_name>GetRepoDependencyList</sys_name>
        <sys_package display_value="Deployer WORK IN PROGRESS" source="x_snc_deployer">394148f9db1c2d906a03dad1f396197a</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="Deployer WORK IN PROGRESS">394148f9db1c2d906a03dad1f396197a</sys_scope>
        <sys_update_name>sys_script_include_e9ee4f1b974ae910a6a07767f053af18</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2023-04-13 11:36:54</sys_updated_on>
    </sys_script_include>
</record_update>
